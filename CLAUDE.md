# CLAUDE.md - プロジェクトガイドライン

## プロジェクト概要
- Flutter アプリ「hakologue」（引越しダンボール管理アプリ）
- 全データは端末内にのみ保存（サーバー通信なし）
- パス: `hakologue/`

---

## セキュリティガイドライン

### 1. コマンド実行時のリスクと対策

#### 絶対に実行してはいけないコマンド
- `rm -rf /` や広範囲の削除コマンド
- `chmod 777` （全ユーザーにフルアクセスを付与してしまう）
- `curl | sh` や `wget | bash` （外部スクリプトの無検証実行）
- `git push --force` を main/master に対して実行
- `git reset --hard` （未コミットの変更が消失する）
- `git clean -fd` （未追跡ファイルが消失する）

#### 実行前に確認が必要なコマンド
- `npm install <パッケージ>` / `flutter pub add <パッケージ>` → パッケージの信頼性を確認
- `git push` → ブランチとリモート先を確認
- `flutter build` → 署名情報やビルド設定を確認
- 環境変数を参照・設定するコマンド → 値の漏洩に注意
- `pod install` / `pod update` → 依存関係の変更内容を確認

#### コマンド実行の原則
- **最小権限**: `sudo` は本当に必要な場合のみ使用
- **ドライラン優先**: `--dry-run` オプションがあるコマンドは先にドライランで確認
- **破壊的操作の前にバックアップ**: データベースのマイグレーション等は事前にバックアップ

### 2. シークレット・認証情報の保護

#### コミットしてはいけないファイル
- `.env` / `.env.*` （環境変数ファイル）
- `*.keystore` / `*.jks` （Android署名鍵）
- `*.p12` / `*.mobileprovision` （iOS証明書）
- `google-services.json` （Firebase設定）
- `GoogleService-Info.plist` （Firebase設定 iOS）
- `local.properties` （ローカル環境パス） ※ 現在gitignoreに未登録
- API キー、トークン、パスワードを含むファイル全般

#### .gitignore に追加すべき項目
```
# Secrets
.env
.env.*
*.keystore
*.jks
*.p12
google-services.json
GoogleService-Info.plist
```

### 3. 依存パッケージのセキュリティ

- `flutter pub outdated` で定期的に古いパッケージを確認
- 新しいパッケージ追加時は pub.dev のスコアと更新頻度を確認
- `dart pub audit` で既知の脆弱性をスキャン（Dart 3.x 以降）
- バージョン固定（`pubspec.lock` をコミット）して予期しない更新を防ぐ

### 4. Flutter / モバイル固有のセキュリティ

- カメラ権限は使用時のみリクエスト（最小権限原則）
- ローカルDB（Isar/Hive）のデータは暗号化を検討
- QRコードの読み取りデータは必ずバリデーション（インジェクション対策）
- 写真のEXIFメタデータは保存前に削除を検討
- デバッグビルドとリリースビルドで動作を分離
- リリースビルドでは `--obfuscate` フラグでコード難読化

### 5. コードレビュー時のセキュリティチェック

- ハードコードされた認証情報・APIキーがないか
- ユーザー入力のバリデーションが適切か
- ログ出力に機密情報が含まれていないか（`print()` でのデバッグ残り）
- 外部URLへのリダイレクトが安全か
- ファイルパスの組み立てにユーザー入力が使われていないか

---

## 開発ルール

### Git 運用
- main ブランチへの直接コミットは避ける
- コミットメッセージは変更の「理由」を書く
- force push は禁止（特に共有ブランチ）

### コーディング
- 不要なコメントやデバッグコードは残さない
- `print()` によるデバッグは本番コードに含めない
- 型安全を活用し、dynamic の使用は最小限に
